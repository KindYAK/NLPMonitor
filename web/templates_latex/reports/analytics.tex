%- extends "base/base.tex"

%- block body
    \chapterimage{/opt/app/templates_latex/base/static/lens.jpg} % Chapter heading image
    %%%%%%%%%%%%%%%%%%%%%%%%% Глава 1 - аналитика %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \chapter{Аналитика}

    %%%%%%%%%%%%%%%%%%%%%%%%% Распределение позитив/негатив %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \BLOCK{if criterion.value_range_from < 0}
        \section{Позитив-негатив}
        \newcommand{\pathbaroverall}{\VAR{bar_overall}}
        \begin{figure}[h]
            \centering\includegraphics[scale=0.6]{\pathbaroverall}
        \end{figure}
    \BLOCK{endif}

    %%%%%%%%%%%%%%%%%%%%%%%%% Динамика критериев %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \section{Динамика}
    \newcommand{\pathdynamics}{\VAR{dynamics}}
    \begin{figure}[h]
        \centering\includegraphics[scale=0.6]{\pathdynamics}
    \end{figure}


    %%%%%%%%%%%%%%%%%%%%%%%%% Глава 2 - детализация %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \chapter{Детализация}
    %%%%%%%%%%%%%%%%%%%%%%%%% Ключевые новости - позитив %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \section{Ключевые новости (Позитив)}
    \begin{longtable}{ | \BLOCK{for criterion in criterions} p{1.5cm} | \BLOCK{endfor} p{3cm} | p{6cm} | p{3cm} | }
        \hline
        \BLOCK{for criterion in criterions}\hspace{0pt}\VAR{criterion.name|e}\BLOCK{endfor} & Дата & Заголовок & Источник \\
        \hline
        \BLOCK{for document in top_documents}
            \BLOCK{for criterion in criterions}
                \BLOCK{if True}
                    \VAR{document|get_item(criterion.id)|round(3)|str|e}
                \BLOCK{else}
                    0,000
                \BLOCK{endif} &
            \BLOCK{endfor}
            \VAR{document.document.datetime|str|substr(0, 10)|e} &
            \VAR{document.document.title|str|e} &
            \VAR{document.document.source|remove_http(1)|str|e}
            \\ \hline
        \BLOCK{endfor}
    \end{longtable}

    %%%%%%%%%%%%%%%%%%%%%%%%% Ключевые новости - негатив %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \BLOCK{if bottom_documents}
        \section{Ключевые новости (Негатив)}
        \begin{longtable}{ | \BLOCK{for criterion in criterions} p{1.5cm} | \BLOCK{endfor} p{3cm} | p{6cm} | p{3cm} | }
            \hline
            \BLOCK{for criterion in criterions}\hspace{0pt}\VAR{criterion.name|e}\BLOCK{endfor} & Дата & Заголовок & Источник \\
            \hline
            \BLOCK{for document in bottom_documents}
                \BLOCK{for criterion in criterions}
                    \BLOCK{if True}
                        \VAR{document|get_item(criterion.id)|round(3)|str|e}
                    \BLOCK{else}
                        0,000
                    \BLOCK{endif} &
                \BLOCK{endfor}
                \VAR{document.document.datetime|str|substr(0, 10)|e} &
                \VAR{document.document.title|str|e} &
                \VAR{document.document.source|remove_http(1)|str|e}
                \\ \hline
            \BLOCK{endfor}
        \end{longtable}
    \BLOCK{endif}
%- endblock
